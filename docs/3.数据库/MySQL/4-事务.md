# 1. 事务

通常将一个或多个数据库操作组成一组，称作**事务**。

事务有4个特性：

* 原子性：一个事务中的多个操作，要么全部成功，要么全部失败

* 一致性：一致性的概念因业务场景的不同而不同，其实就是保证业务数据的正确性，使数据和预期一致

* 隔离性：事务的执行，不受其它事务的干扰。不同的隔离级别对数据的一致性会有不同的影响。

* 持久性：**已经完成的事务**，系统必须保证这个事务对数据库的更改不会丢失，即使发生故障（数据库软件故障，操作系统故障，突然断电等导致内存数据丢失的故障）。磁盘故障和自然灾害不算在这些故障里面。

为什么需要事务？为了保证一次业务逻辑的完整性。

涉及命令：`begin`, `commit`, `rollback`


# 2. 日志

对于数据库的每一个变化，都会在磁盘上记录日志。

# 3. 锁

锁的作用其实就是**管理对共享资源的并发访问**。

在数据库层面，锁其实是为了防止两个事务**以造成不良后果的方式**存取数据的相同部分。

如果非要说，锁的本质是什么？其实就是内存里的一些变量，只不过这些变量有特殊的用处，就被称为所谓的锁了。

有时候，如果不能使用索引来查找和锁定行的话，InnoDB可能会做全表扫描，并锁住所有的行。


悲观锁：假设其它事务都会修改该数据，所以在一开始就会对数据进行加锁以防止其它事务修改。

乐观锁：假设其它事务不会修改该数据，不会在一开始就对数据加锁，而是在修改的时候判断下数据有没有被其它事务修改，如果没有的话，则更新成功。否则的话，可以进行重试，或者返回错误信息。乐观锁可以通过加一个版本号字段来实现。适用于读操作比较多，竞争写操作比较少的场景，因为不需要提前加锁，和完成操作后的解锁操作，所以效率会比悲观锁好。



# 4. 间隙锁

有没有走索引

* 主键索引

* unique辅助索引

* 辅助索引

查询类型

* 等值查询

* 范围查询（大于还是小于）

是否存在where条件中的值

* 存在

* 不存在




















