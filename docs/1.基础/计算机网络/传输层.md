
# 1. 传输层

网络应用的基础，其实就是**进程间消息交换**。

网络层提供不同主机之间的逻辑通信，传输层则提供不同主机上不同进程之间的逻辑通信。

网络层提供主机到主机的数据交付服务，传输层为运行在主机上的应用程序提供进程到进程的数据交付服务。

一个主机上的进程，要和另外一台主机上的进程进行通信，需要知道另一台主机的地址，即IP地址，也需要知道要和主机上的哪一个进程进行通信，即进程的端口号（操作系统用不同的端口来标识不同的进程）。

传输层只工作在端系统中。

将运输层报文段中的数据，分解到正确的套接字，这叫做多路分解。

在源主机从不同套接字中收集数据块，并为其封装上首部信息（用于以后分解），从而生成报文段，然后将数据报传递到网络层，这叫做多路复用。

因为报文段中有目的端口号，当报文段到达主机时，运输层检查报文段中的目的端口号，并将其定向到相应的套接字，然后报文段中的数据通过套接字进入其所连接的进程。

把进程当作一栋房子，套接字则是房子的门。报文进出都要经过套接字。

可以通过一个5元组来唯一确认一台计算机上面的某个Socket：源IP，目的IP，协议类型，源端口，目的端口。

端口号（加上协议类型，即TCP或UDP）用于识别同一台计算机中正在进行通信的某个进程。
IP地址用于在整个网络中标识一台计算机（或路由器）。
MAC地址用于在同一个网段中（一般为同一个局域网内）标识一台计算机（或路由器）。

计算机网络通信和电话通信不同。电话只能用来进行一个任务，那就是通话，所以一个电话号码就可以标识一台电话。而计算机可以同时运行很多任务（进程），而每个进程都可以进行网络通信。所以计算机通信的对象其实是**计算机中的进程**。IP地址用来唯一确定一台计算机，而端口号就是用来确认与这台计算机上哪个进程进行通信。即**端口号**是用来标识一个进程的。


# 2. TCP和UDP的区别

TCP是面向连接的通信协议，并且提供可靠传输，而且还提供了拥塞控制，流量控制等机制。

UDP是无连接的通信协议，并且不提供可靠传输。

TCP应用场景：HTTP，FTP等等。

UDP应用场景：对实时性要求较高并且对准确性要求不太高的通信，广播或多播通信，传输的网络包很小的时候，比如在线语音、在线视频，DNS等等。


# 3. TCP

TCP四个重点：连接维护，可靠传输，流量控制，拥塞控制。

## 连接维护

TCP三个阶段：建立连接，收发数据，断开连接。

所谓的建立连接，是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态(每个TCP连接都要占用一定的内存)，用这样的数据结构来保证所谓的面向连接的特性。

TCP本身是可以双方通时收发数据的，不过在HTTP的场景下，服务器需要完整的解析HTTP请求报文，所以只有当客户端发完后，然后服务器解析并处理请求报文，之后再返回响应报文。

![image.png](https://upload-images.jianshu.io/upload_images/1754553-2f4394b40b183f4c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![image.png](https://upload-images.jianshu.io/upload_images/1754553-25f5b64aed9826f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![image.png](https://upload-images.jianshu.io/upload_images/1754553-20295fcb06d3980e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![image.png](https://upload-images.jianshu.io/upload_images/1754553-02555ebd6b942138.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


## 可靠交付

TCP提供可靠交付。通过TCP连接传输的数据，无差错、不丢失、不重复、无乱序。

TCP可以通过“序号”和“ACK序号”，来确保接收方收到了网络包。因为，在得到对方确认之前，发过的包都会保存在发送缓冲区中，如果对方在某段时间内没有返回某些包对应的ACK号，那么就重新发送这些包。

TCP会根据ACK包的返回快慢，动态地调整**等待时间**（若超过这个时间没收到ACK确认，就重发一次）。

为什么需要ACK回复？因为只有收到了ACK回复，发送方才可以确认刚刚的包发送成功了。

TCP中的ACK序号，表示“告诉另一端，这个序号之前的数据我都已经收到了”。

## 流量控制

流量控制，主要是防止发送方传输太多，太快，以至于淹没接收方的缓冲区。

当发送方发送网络包的速率过快时，可能会出现**发送包的速度超过了接收方的处理能力**这种情况。所以接收方需要告诉发送方**自己最多能接收多少数据**，然后发送方根据这个值对发送操作进行控制。这个**接收方能够接收的最大数据量**被称为**窗口大小**。

## 拥塞控制

拥塞控制，主要是防止发送方传输太多，太快，以至于造成网络拥堵。
它意识到包丢弃了或者网络的环境不好了，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点。











