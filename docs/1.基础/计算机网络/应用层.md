

# 1. 分层和协议

网络为什么要分层？其实，是个复杂的程序都要分层。如果互联网只有一个协议统筹，那某个地方需要改变设计时，就必须要把所有部分整体替换掉，这简直是不可想象的。而分层之后只需把变动的层替换掉即可。把各层之间的接口部分规划好之后，每个层内部的设计就能够自由改动了。

OSI标准（七层）：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
五层标准：物理层、数据链路层、网络层、运输层、应用层

**协议**，其实就是**为了某种目的而预先约定好的一些规则**。网络协议其实就是为了达成网络通信定制的一些规则。

协议只是制定出了一套标准，具体的实现是由各个网络厂商去做的，而他们的实现方式，可能并不一定完全按照协议标准去做，可能会有一些调整。

不同的硬件，操作系统之间的通信，都需要一种规则，我们就把这些规则称为**网络协议**。

# 2. HTTP


Web的三个构建技术：URL，HTML，HTTP。只不过现在HTTP协议已经超出了Web这个框架的局限，被运用到了各种场景里。

HTTP协议本身是一个无状态的协议，因此服务器没法判断两次HTTP请求是否有关联关系。所以就在HTTP请求头部加了一个叫做`Cookie`的字段，用于让服务器去判断这些请求是否是有关联关系的。


## HTTP报文结构
请求报文：请求行(请求类型、URI、HTTP方法版本)、请求头(一系列键值对)、请求体。
响应报文：响应行(HTTP方法版本、状态码、状态说明)、响应头(一系列键值对)、响应体。

不用刻意去死记硬背请求头和响应头，它们都是为了解决某些问题而设计的，要知道它们的设计用意是什么。


## HTTP状态码
101：切换协议，例如WebSocket
200：请求成功
301，302：请求重定向
304：请求内容没有改变，使用缓存
404：请求页面没有找到
405：请求方法不被允许
500：服务器内部错误

响应码304：

若请求的响应头里带有“Last-Modified”字段，则客户端在下次请求时，请求头里会带上“If-Modified-Since”字段，如果该请求对象在服务器端没有改变过，则会仅仅返回一个包含304响应码的响应头，而不会把请求体返回。
这样客户端接收到304响应码时，便会从浏览器的缓存中获取请求对象，将其渲染到浏览器。



## HTTP1.1和HTTP1.0的区别？
HTTP1.0不支持长连接，请求一个页面时，若页面内有图片等资源，则每次请求都要再建立一次TCP连接。
HTTP1.1支持长连接，请求一个页面时，若页面内有图片等资源，则可以共用一个TCP连接。
长连接通过请求头和响应头里的"Connection: keep-alive"来设置。


## Cookie与Session的作用于原理？
Session是在服务器端生成的一个标记，维护在服务器的内存里，通过将session-id写入客户端的cookie，然后每次请求时带上session-id，来辨别用户身份。
Cookie是存储在浏览器上的若干键值对，是由服务器的响应报文里的set-cookie设置到浏览器端的，若不设置cookie期限，则重启浏览器后cookie会失效。


## GET和POST的区别？
get方法将请求数据以键值对的方式拼接到url后面，
post方法将请求数据添加至请求体里，如果有隐私数据，相对更安全些。
get方法的请求数据大小有限制，
post方法的请求数据大小没有限制。
get方法一般用于查询，
post方法一般用于更新


## 访问www.baidu.com到返回页面的过程

首先，浏览器会解析URL`http://www.baidu.com`。解析完后，浏览器知道要用HTTP协议，去请求域名`www.baidu.com`，URI为`/`，请求方法为`GET`，然后根据这些信息生成请求报文。

接着，浏览器会获取域名对应的IP地址。

首先检查本地的hosts文件中，是否有该域名对应的IP，如果有，则直接使用这个IP。

如果hosts文件中没有该域名对应的IP，则通过DNS（基于UDP的二进制协议）将域名解析为对应的IP地址。这个过程是通过调用操作系统的Socket库中的域名解析组件来完成的，该组件将`http://www.baidu.com`这个域名和记录类型（记录类型为`A`，表示Address，即获取IP地址）封装到DNS请求报文中，将请求报文发送给DNS服务器，然后DNS服务器返回它解析完的IP地址。

HTTP协议是通过TCP协议来进行收发数据的，所以首先需要三次握手建立TCP连接。

TCP会将HTTP请求报文拆分成一个个数据块，并加上TCP头（包括端口号，序号等等）进行发送。
其实发送端在发送数据时，每经过一层时都会被打上该层的首部信息。

在发送给每个数据块的时候，都需要对方有一个回应 ACK，来保证报文可靠地到达了对方。如果没有回 应，那么TCP 这一层会进行重新传输，直到可以到达。同一个包有可能被传了好多次，但是 HTTP 这一层不需要知道这一点，因为是 TCP 这一层在埋头苦干。

TCP 层发送每一个报文的时候，都需要加上自己的地址(即源地址)和它想要去的地方(即目标地 址)，将这两个信息放到 IP 头里面，交给 IP 层进行传输。
IP 层需要查看目标地址和自己是否是在同一个局域网。如果是，就发送 ARP 协议来请求这个目标地址对 应的 MAC 地址，然后将源 MAC 和目标 MAC 放入 MAC 头，发送出去即可;如果不在同一个局域网， 就需要发送到网关，还要需要发送 ARP 协议，来获取网关的 MAC 地址，然后将源 MAC 和网关 MAC 放入 MAC 头，发送出去。
网关收到包发现 MAC 符合，取出目标 IP 地址，根据路由协议找到下一跳的路由器，获取下一跳路由器 的 MAC 地址，将包发给下一跳路由器。
这样路由器一跳一跳终于到达目标的局域网。这个时候，最后一跳的路由器能够发现，目标地址就在自 己的某一个出口的局域网上。于是，在这个局域网上发送 ARP，获得这个目标地址的 MAC 地址，将包 发出去。
目标的机器发现 MAC 地址符合，就将包收起来;发现 IP 地址符合，根据 IP 头中协议项，知道自己上 一层是 TCP 协议，于是解析 TCP 的头，里面有序列号，需要看一看这个序列包是不是我要的，如果是 就放入缓存中然后返回一个 ACK，如果不是就丢弃。
TCP 头里面还有端口号，HTTP 的服务器正在监听这个端口号。于是，目标机器自然知道是 HTTP 服务 器这个进程想要这个包，于是将包发给 HTTP 服务器。HTTP 服务器的进程看到，原来这个请求是要访 问一个网页，于是就把这个网页发给客户端。

服务器构造好了返回的 HTTP 报文，接下来就是把这个报文发送出去。还是交给 Socket 去发送，还是交给
TCP 层，让 TCP 层将返回的 HTML，也分成一个个小的段，并且保证每个段都可靠到达。
这些段加上 TCP 头后会交给 IP 层，然后把刚才的发送过程反向走一遍。虽然两次不一定走相同的路 径，但是逻辑过程是一样的，一直到达客户端。
客户端发现 MAC 地址符合、IP 地址符合，于是就会交给 TCP 层。根据序列号看是不是自己要的报文 段，如果是，则会根据 TCP 头中的端口号，发给相应的进程。这个进程就是浏览器，浏览器作为客户端 也在监听某个端口。
当浏览器拿到了 HTTP 的报文。发现返回“200”，一切正常，于是就从正文中将 HTML 拿出来。 HTML 是一个标准的网页格式。浏览器只要根据这个格式，展示出一个绚丽多彩的网页。
这就是一个正常的 HTTP 请求和返回的完整过程。


# 3. HTTPS

HTTPS的意思是Secure HTTP，即安全的HTTP。

要保证一次网络通信的安全，需要注意3点：

* 机密性（即要对数据进行加密）

* 数据完整性（要确保数据在传输过程中没有被篡改）

* 端点鉴别（确保通信双方身份的真实性）

![image.png](https://upload-images.jianshu.io/upload_images/1754553-35e9f6b00130cc14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

https://mp.weixin.qq.com/s/StqqafHePlBkWAPQZg3NrA


# 4. 其它应用层协议

## FTP

FTP使用了两个并行的TCP连接：控制连接（21）和数据连接（20）。
FTP是有状态的，服务器必须把特定的用户账户与控制连接联系起来。


## 电子邮件

SMTP：用于从发送方的邮件服务器，发送报文，到接受方的服务器。
POP3和IMAP：用于从接收方的邮件服务器里，拉取邮件到本地。

SMTP是“推协议”；
POP3，IMAP，HTTP都是“拉协议”。

每个邮件服务器都会，为每个用户维护一个“接收邮箱”。

## DNS

通过域名查找IP

查看DNS服务器地址：nslookup->server

人喜欢域名（带有某种含义的字母或数字），因为好记；
计算机喜欢IP地址（定长的数字），因为好处理。
为了折衷人和计算机的不同偏好，需要有一种将域名转换为IP地址的服务，这便是DNS（域名系统）的任务。


DNS是一个分层的分布式数据库，也是一个使得主机能够查询分布式数据库的应用层协议。

有四中DNS服务器：根域名服务器，顶级域名服务器，权威服务器，本地服务器。

13个根域名服务器，其实不是简单的“几个”。其中“每一个”都是一组分布在不同位置的含有相同内容的冗余服务器，以提供安全性和可靠性。


域名查询的方式有：递归查询，迭代查询。


DNS服务器里存储了许多资源记录（Resource Record），这是一个4元组（Name，Value，Type，TTL）。
Type有四种类型，A，NS，CNAME，MX。







